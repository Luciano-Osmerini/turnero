<!DOCTYPE HTML>
<html>
	<head>
		<title>JV Spa Urbano - Panel Administrador</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
			/* Estilos espec√≠ficos para el panel de administrador */
			.admin-container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 2rem;
				background: rgba(0, 0, 0, 0.8);
				border-radius: 10px;
				margin-top: 2rem;
			}

			.login-form {
				max-width: 400px;
				margin: 0 auto;
				text-align: center;
			}

			.login-form h2 {
				color: #1cb495;
				margin-bottom: 2rem;
			}

			.login-form .form-group {
				margin-bottom: 1.5rem;
				text-align: left;
			}

			.login-form label {
				color: #ffffff;
				font-weight: bold;
				margin-bottom: 0.5rem;
				display: block;
			}

			.login-form input {
				width: 100%;
				padding: 0.75rem;
				background: rgba(255, 255, 255, 0.1);
				border: 2px solid #1cb495;
				border-radius: 5px;
				color: #ffffff;
				font-size: 1rem;
			}

			.login-form input:focus {
				outline: none;
				border-color: #17a085;
				box-shadow: 0 0 8px rgba(28, 180, 149, 0.4);
			}

			.login-btn {
				background: #1cb495;
				color: #ffffff;
				padding: 0.75rem 2rem;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				font-size: 1rem;
				font-weight: bold;
				margin-top: 1rem;
				width: 100%;
			}

			.login-btn:hover {
				background: #17a085;
			}

			.error-message {
				color: #e74c3c;
				margin-top: 1rem;
				font-weight: bold;
			}

			.admin-header {
				text-align: center;
				margin-bottom: 2rem;
			}

			.admin-header h1 {
				color: #1cb495;
				margin-bottom: 0.5rem;
			}

			.admin-header p {
				color: rgba(255, 255, 255, 0.8);
			}

			.logout-btn {
				float: right;
				background: #e74c3c;
				color: #ffffff;
				padding: 0.5rem 1rem;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				text-decoration: none;
			}

			.logout-btn:hover {
				background: #c0392b;
			}

			/* Calendario de administrador */
			.admin-calendar {
				background: rgba(255, 255, 255, 0.05);
				border-radius: 10px;
				padding: 2rem;
				margin-top: 2rem;
			}

			.calendar-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 2rem;
			}

			.calendar-nav {
				background: #1cb495;
				color: #ffffff;
				border: none;
				padding: 0.5rem 1rem;
				border-radius: 5px;
				cursor: pointer;
				font-size: 1.2rem;
				font-weight: bold;
			}

			.calendar-nav:hover {
				background: #17a085;
			}

			.calendar-title {
				color: #1cb495;
				font-size: 1.8rem;
				font-weight: bold;
				margin: 0;
			}

			.calendar-grid {
				display: grid;
				grid-template-columns: repeat(7, 1fr);
				gap: 1px;
				background: rgba(255, 255, 255, 0.1);
				border-radius: 5px;
				overflow: hidden;
			}

			.calendar-day-header {
				background: #1cb495;
				color: #ffffff;
				padding: 1rem;
				text-align: center;
				font-weight: bold;
			}

			.calendar-day {
				background: rgba(255, 255, 255, 0.05);
				min-height: 120px;
				padding: 0.5rem;
				position: relative;
			}

			.calendar-day.other-month {
				background: rgba(255, 255, 255, 0.02);
				opacity: 0.5;
			}

			.calendar-day.today {
				background: rgba(28, 180, 149, 0.2);
			}

			.day-number {
				color: #ffffff;
				font-weight: bold;
				margin-bottom: 0.5rem;
			}

			.appointment {
				background: #1cb495;
				color: #ffffff;
				padding: 0.25rem;
				margin-bottom: 0.25rem;
				border-radius: 3px;
				font-size: 0.8rem;
				cursor: pointer;
			}

			.appointment:hover {
				background: #17a085;
			}

			.appointment-time {
				font-weight: bold;
			}

			.appointment-client {
				opacity: 0.9;
			}

			.appointment-service {
				font-style: italic;
				font-size: 0.7rem;
			}

			.no-appointments {
				color: rgba(255, 255, 255, 0.5);
				font-style: italic;
				font-size: 0.8rem;
			}

			.stats-container {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
				gap: 1rem;
				margin-bottom: 2rem;
			}

			.stat-card {
				background: rgba(255, 255, 255, 0.1);
				padding: 1.5rem;
				border-radius: 8px;
				text-align: center;
			}

			.stat-number {
				font-size: 2rem;
				font-weight: bold;
				color: #1cb495;
				margin-bottom: 0.5rem;
			}

			.stat-label {
				color: rgba(255, 255, 255, 0.8);
				font-size: 0.9rem;
			}

			.hidden {
				display: none !important;
			}

			/* Botones de acci√≥n */
			.admin-actions {
				display: flex;
				gap: 1rem;
				margin-bottom: 2rem;
				justify-content: center;
				flex-wrap: wrap;
			}

			.action-button {
				padding: 0.75rem 1.5rem;
				border: none;
				border-radius: 8px;
				color: white;
				font-weight: bold;
				cursor: pointer;
				font-size: 0.9rem;
				transition: all 0.3s ease;
			}

			.add-btn { background: #28a745; }
			.add-btn:hover { background: #218838; }

			.block-btn { background: #dc3545; }
			.block-btn:hover { background: #c82333; }

			.fixed-btn { background: #007bff; }
			.fixed-btn:hover { background: #0056b3; }

			/* Lista de turnos del d√≠a */
			.appointments-list-container {
				background: rgba(255, 255, 255, 0.1);
				padding: 1.5rem;
				border-radius: 10px;
				margin-bottom: 2rem;
			}

			.appointments-list-container h3 {
				color: #1cb495;
				margin-bottom: 1rem;
				text-align: center;
			}

			.appointment-item {
				background: rgba(255, 255, 255, 0.1);
				padding: 1rem;
				margin-bottom: 0.5rem;
				border-radius: 5px;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.appointment-info {
				flex-grow: 1;
			}

			.appointment-actions {
				display: flex;
				gap: 0.5rem;
			}

			.btn-small {
				padding: 0.25rem 0.5rem;
				border: none;
				border-radius: 3px;
				color: white;
				cursor: pointer;
				font-size: 0.8rem;
			}

			.btn-delete { background: #dc3545; }
			.btn-edit { background: #ffc107; color: #000; }
			
			.calendar-day.clickable {
				cursor: pointer;
				transition: background-color 0.2s;
			}
			
			.calendar-day.clickable:hover {
				background: rgba(28, 180, 149, 0.3) !important;
			}
			
			.calendar-day.selected {
				background: rgba(28, 180, 149, 0.5) !important;
				border: 2px solid #1cb495;
			}

			/* Modal Styles */
			.modal {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.8);
				z-index: 1000;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.modal-content {
				background: rgba(0, 0, 0, 0.9);
				padding: 2rem;
				border-radius: 10px;
				width: 90%;
				max-width: 500px;
				border: 2px solid #1cb495;
			}

			.modal-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 1.5rem;
			}

			.modal-header h2 {
				color: #1cb495;
				margin: 0;
			}

			.close-btn {
				background: none;
				border: none;
				color: #ffffff;
				font-size: 1.5rem;
				cursor: pointer;
				padding: 0;
				width: 30px;
				height: 30px;
			}

			.form-group {
				margin-bottom: 1rem;
			}

			.form-group label {
				display: block;
				color: #ffffff;
				margin-bottom: 0.5rem;
				font-weight: bold;
			}

			.form-group input,
			.form-group select {
				width: 100%;
				padding: 0.75rem;
				background: rgba(255, 255, 255, 0.1);
				border: 2px solid #1cb495;
				border-radius: 5px;
				color: #ffffff;
				font-size: 1rem;
			}

			.form-group input:focus,
			.form-group select:focus {
				outline: none;
				border-color: #17a085;
				box-shadow: 0 0 8px rgba(28, 180, 149, 0.4);
			}

			.form-actions {
				display: flex;
				gap: 1rem;
				justify-content: end;
				margin-top: 1.5rem;
			}

			.cancel-btn {
				background: #6c757d;
				color: white;
				padding: 0.75rem 1.5rem;
				border: none;
				border-radius: 5px;
				cursor: pointer;
			}

			.save-btn {
				background: #28a745;
				color: white;
				padding: 0.75rem 1.5rem;
				border: none;
				border-radius: 5px;
				cursor: pointer;
			}

			.cancel-btn:hover { background: #545b62; }
			.save-btn:hover { background: #218838; }
		</style>
	</head>
	<body class="is-preload">

		<!-- Login Section -->
		<div id="login-section" class="admin-container">
			<div class="login-form">
				<h2>üîê Panel de Administrador</h2>
				<p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 2rem;">Acceso exclusivo para Jesica Vergara</p>
				
				<form id="admin-login-form">
					<div class="form-group">
						<label for="admin-username">üë§ Usuario:</label>
						<input type="text" id="admin-username" name="username" required placeholder="Ingres√° tu nombre de usuario">
					</div>
					<div class="form-group">
						<label for="admin-password">üîí Contrase√±a:</label>
						<input type="password" id="admin-password" name="password" required placeholder="Ingres√° tu contrase√±a">
					</div>
					<button type="submit" class="login-btn">üöÄ Ingresar al Panel</button>
					<div id="login-error" class="error-message hidden"></div>
				</form>
			</div>
		</div>

		<!-- Admin Panel -->
		<div id="admin-panel" class="admin-container hidden">
			<div class="admin-header">
				<div>
					<button class="logout-btn" id="logout-btn">üö™ Cerrar Sesi√≥n</button>
					<button class="logout-btn" id="debug-btn" style="margin-right: 1em; background: #17a2b8;">üîç Debug</button>
					<button class="logout-btn" id="refresh-btn" style="margin-right: 1em; background: #28a745;">üîÑ Refrescar</button>
				</div>
				<h1>üíÜ‚Äç‚ôÄÔ∏è Panel de Administrador - JV Spa Urbano</h1>
				<p>Bienvenida Jesica! Aqu√≠ pod√©s ver todos tus turnos del mes</p>
				
				<!-- Informaci√≥n de Horarios -->
				<div class="schedule-info" style="background: rgba(28, 180, 149, 0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border-left: 4px solid #1cb495;">
					<h4 style="color: #1cb495; margin-bottom: 0.5rem;">üìÖ Horarios de Atenci√≥n de Jessica</h4>
					<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 0.5rem; font-size: 0.85rem;">
						<div><strong>ÔøΩ Lunes:</strong> 14:00 - 19:30 (Tarde)</div>
						                        <p><strong>ÔøΩ Martes:</strong> 09:00 - 18:00 (Completo)</p>
						<div><strong>ÔøΩ Mi√©rcoles:</strong> 14:00 - 19:30 (Tarde)</div>
						<div>                        <p><strong>ÔøΩ Jueves:</strong> 09:00 - 18:00 (Completo)</p></div>
						<div><strong>ÔøΩ Viernes:</strong> 09:00 - 16:00 (Reducido)</div>
						<div style="grid-column: 1/-1; text-align: center; color: rgba(255,255,255,0.6); margin-top: 0.5rem;">
							<strong>üî¥ S√°bados y Domingos:</strong> CERRADO
						</div>
					</div>
				</div>
				
				<div id="debug-info" class="hidden" style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; font-family: monospace; font-size: 0.9rem;"></div>
			</div>

			<!-- Estad√≠sticas -->
			<div class="stats-container">
				<div class="stat-card">
					<div class="stat-number" id="total-appointments">0</div>
					<div class="stat-label">üìÖ Turnos este mes</div>
				</div>
				<div class="stat-card">
					<div class="stat-number" id="today-appointments">0</div>
					<div class="stat-label">üïê Turnos hoy</div>
				</div>
				<div class="stat-card">
					<div class="stat-number" id="week-appointments">0</div>
					<div class="stat-label">üìÜ Turnos esta semana</div>
				</div>
			</div>

			<!-- Botones de Acci√≥n R√°pida -->
			<div class="admin-actions">
				<button class="action-button add-btn" id="add-appointment-btn">‚ûï Agregar Turno</button>
				<button class="action-button block-btn" id="block-time-btn">üö´ Ocupar Horario</button>
				<button class="action-button fixed-btn" id="add-fixed-btn">üìå Turno Fijo</button>
			</div>

			<!-- Lista de Turnos del D√≠a Seleccionado -->
			<div class="appointments-list-container">
				<h3 id="selected-date-title">Seleccionar un d√≠a en el calendario</h3>
				<div id="day-appointments-list"></div>
			</div>

			<!-- Calendario -->
			<div class="admin-calendar">
				<div class="calendar-header">
					<button class="calendar-nav" id="prev-month">‚Üê Mes Anterior</button>
					<h3 class="calendar-title" id="current-month-title"></h3>
					<button class="calendar-nav" id="next-month">Mes Siguiente ‚Üí</button>
				</div>
				<div class="calendar-grid" id="admin-calendar-grid">
					<div class="calendar-day-header">Dom</div>
					<div class="calendar-day-header">Lun</div>
					<div class="calendar-day-header">Mar</div>
					<div class="calendar-day-header">Mi√©</div>
					<div class="calendar-day-header">Jue</div>
					<div class="calendar-day-header">Vie</div>
					<div class="calendar-day-header">S√°b</div>
				</div>
			</div>
		</div>

		<!-- Modales para gesti√≥n de turnos -->
		<div id="appointment-modal" class="modal hidden">
			<div class="modal-content">
				<div class="modal-header">
					<h2 id="modal-title">Agregar Turno</h2>
					<button class="close-btn" id="close-modal">&times;</button>
				</div>
				<form id="appointment-form">
					<div class="form-group">
						<label for="appointment-date">Fecha:</label>
						<input type="date" id="appointment-date" required>
					</div>
					<div class="form-group">
						<label for="appointment-time">Hora:</label>
						<select id="appointment-time" required>
							<option value="">Seleccionar hora (depende del d√≠a)</option>
						</select>
					</div>
					<div class="form-group">
						<label for="client-name">Cliente:</label>
						<input type="text" id="client-name" placeholder="Nombre del cliente" required>
					</div>
					<div class="form-group">
						<label for="client-phone">Tel√©fono:</label>
						<input type="tel" id="client-phone" placeholder="Ej: 351-1234567" required>
					</div>
					<div class="form-group">
						<label for="service-select">Servicio:</label>
						<select id="service-select" required>
							<option value="">Seleccionar servicio</option>
							<optgroup label="Faciales">
								<option value="Limpieza Profunda">Limpieza Profunda - $16.000</option>
								<option value="Renovaci√≥n Celular">Renovaci√≥n Celular - $20.000</option>
								<option value="Estimulaci√≥n Celular">Estimulaci√≥n Celular - $25.000</option>
								<option value="Exosomas">Exosomas - $30.000</option>
								<option value="Dermaplaning">Dermaplaning - $19.000</option>
							</optgroup>
							<optgroup label="Masajes">
								<option value="Masajes Desc. Superior">Masajes Desc. Superior - $16.000</option>
								<option value="Masajes desc. Cuerpo/c">Masajes desc. Cuerpo/c - $22.000</option>
								<option value="Drenantes Piernas">Drenantes Piernas - $12.000</option>
								<option value="Drenantes Cuerpo Comp.">Drenantes Cuerpo Comp. - $22.000</option>
							</optgroup>
							<optgroup label="Cejas">
								<option value="Laminado-Perfilado-Visagismo">Laminado-Perfilado-Visagismo - $17.000</option>
								<option value="Perfilado Visagismo">Perfilado Visagismo - $10.000</option>
								<option value="Cejas Completas + Henna">Cejas Completas + Henna - $20.000</option>
							</optgroup>
							<optgroup label="Corporal">
								<option value="Tratamiento Corporal">Tratamiento Corporal - $25.000</option>
							</optgroup>
							<optgroup label="Especiales">
								<option value="OCUPADO">üö´ HORARIO OCUPADO</option>
								<option value="TURNO FIJO">üìå TURNO FIJO</option>
							</optgroup>
						</select>
					</div>
					<div class="form-actions">
						<button type="button" class="cancel-btn" id="cancel-appointment">Cancelar</button>
						<button type="submit" class="save-btn">üíæ Guardar Turno</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Firebase Scripts -->
		<script type="module">
			// Import Firebase modules
			import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
			import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, where, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

			// Firebase configuration
			const firebaseConfig = {
				apiKey: "AIzaSy4xJh7UfinFp_xCaADq1SlY3qO4FDlw",
				authDomain: "jv-spa-turnos.firebaseapp.com",
				projectId: "jv-spa-turnos",
				storageBucket: "jv-spa-turnos.firebasestorage.app",
				messagingSenderId: "525378824571",
				appId: "1:525378824571:web:732806a7a368575e475de"
			};

			// Initialize Firebase
			const app = initializeApp(firebaseConfig);
			const db = getFirestore(app);

			// Make Firebase available globally
			window.firebaseDb = db;
			window.firebaseModules = {
				collection,
				addDoc,
				getDocs,
				deleteDoc,
				doc,
				updateDoc,
				query,
				where,
				orderBy,
				onSnapshot
			};
		</script>
		
		<!-- Main App Script -->
		<script src="assets/js/main.js"></script>
		<script>
			// Sistema de administrador
			const AdminPanel = {
				currentMonth: new Date(),
				appointments: [], // Se llenar√° con datos simulados
				isLoggedIn: false,
				selectedDate: null,
				editingAppointment: null,

				// Datos de login
				credentials: {
					username: 'Jesica Vergara',
					password: 'Jesica Vergara'
				},

			init: async function() {
				await this.loadAppointments();
				this.bindEvents();
				this.checkLogin();
				this.startAutoRefresh();
			},				loadAppointments: async function() {
					// Cargar turnos reales desde Firebase
					try {
						if (!window.firebaseDb) {
							console.log('Firebase no disponible, usando localStorage como respaldo');
							const storedAppointments = localStorage.getItem('jvSpaAppointments');
							this.appointments = storedAppointments ? JSON.parse(storedAppointments) : [];
						} else {
							const { collection, getDocs } = window.firebaseModules;
							const appointmentsRef = collection(window.firebaseDb, 'appointments');
							const querySnapshot = await getDocs(appointmentsRef);
							
							this.appointments = [];
							querySnapshot.forEach((doc) => {
								this.appointments.push({ id: doc.id, ...doc.data() });
							});
						}
						
						// Si no hay turnos reales, mostrar algunos de ejemplo para demostraci√≥n
						if (this.appointments.length === 0) {
							this.loadSampleData();
						}
					} catch (e) {
						console.error('Error al cargar turnos:', e);
						this.appointments = [];
						this.loadSampleData();
					}
				},

				loadSampleData: function() {
					// Solo para demostraci√≥n cuando no hay turnos reales
					const today = new Date();
					const currentMonth = today.getMonth();
					const currentYear = today.getFullYear();

					this.appointments = [
						{
							id: 999991,
							date: new Date(currentYear, currentMonth, 5).toISOString().split('T')[0],
							time: '09:30',
							clientName: 'Mar√≠a Gonz√°lez (Demo)',
							clientPhone: '351-123-4567',
							service: 'Limpieza Profunda',
							isDemo: true
						},
						{
							id: 999992,
							date: new Date(currentYear, currentMonth, 8).toISOString().split('T')[0],
							time: '14:00',
							clientName: 'Ana L√≥pez (Demo)',
							clientPhone: '351-987-6543',
							service: 'Masajes Desc. Superior',
							isDemo: true
						}
					];
				},

				bindEvents: function() {
					// Login
					document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
						e.preventDefault();
						await this.handleLogin();
					});

				// Logout
				document.getElementById('logout-btn').addEventListener('click', () => {
					this.logout();
				});

				// Debug
				document.getElementById('debug-btn').addEventListener('click', () => {
					this.showDebugInfo();
				});

				// Refresh
				document.getElementById('refresh-btn').addEventListener('click', () => {
					this.refreshData();
					this.renderCalendar();
					this.updateStats();
					alert('‚úÖ Panel actualizado! Si hab√≠a un turno nuevo, ahora deber√≠a aparecer.');
				});					// Navegaci√≥n del calendario
					document.getElementById('prev-month').addEventListener('click', () => {
						this.currentMonth.setMonth(this.currentMonth.getMonth() - 1);
						this.renderCalendar();
						this.updateStats();
					});

					document.getElementById('next-month').addEventListener('click', () => {
						this.currentMonth.setMonth(this.currentMonth.getMonth() + 1);
						this.renderCalendar();
						this.updateStats();
					});

					// Botones de acci√≥n
					document.getElementById('add-appointment-btn').addEventListener('click', () => {
						this.showAppointmentModal('add');
					});

					document.getElementById('block-time-btn').addEventListener('click', () => {
						this.showAppointmentModal('block');
					});

					document.getElementById('add-fixed-btn').addEventListener('click', () => {
						this.showAppointmentModal('fixed');
					});

					// Modal events
					document.getElementById('close-modal').addEventListener('click', () => {
						this.hideAppointmentModal();
					});

					document.getElementById('cancel-appointment').addEventListener('click', () => {
						this.hideAppointmentModal();
					});

					document.getElementById('appointment-form').addEventListener('submit', (e) => {
						e.preventDefault();
						this.saveAppointment();
					});

					// Actualizar horarios cuando cambie la fecha
					document.getElementById('appointment-date').addEventListener('change', (e) => {
						const selectedDate = new Date(e.target.value);
						this.updateAvailableTimes(selectedDate);
					});
				},

				handleLogin: async function() {
					const username = document.getElementById('admin-username').value;
					const password = document.getElementById('admin-password').value;

					if (username === this.credentials.username && password === this.credentials.password) {
						this.isLoggedIn = true;
						this.showAdminPanel();
						await this.loadAppointments();
						this.renderCalendar();
						this.updateStats();
					} else {
						this.showError('Usuario o contrase√±a incorrectos');
					}
				},

				showError: function(message) {
					const errorDiv = document.getElementById('login-error');
					errorDiv.textContent = message;
					errorDiv.classList.remove('hidden');
				},

				showAdminPanel: function() {
					document.getElementById('login-section').classList.add('hidden');
					document.getElementById('admin-panel').classList.remove('hidden');
				},

				logout: function() {
					this.isLoggedIn = false;
					document.getElementById('admin-panel').classList.add('hidden');
					document.getElementById('login-section').classList.remove('hidden');
					document.getElementById('admin-login-form').reset();
					document.getElementById('login-error').classList.add('hidden');
				},

			checkLogin: function() {
				// En una implementaci√≥n real, verificar√≠as la sesi√≥n guardada
				this.logout();
			},

			startAutoRefresh: function() {
				// Actualizar cada 30 segundos para mostrar nuevos turnos
				setInterval(async () => {
					if (this.isLoggedIn) {
						await this.refreshData();
					}
				}, 30000);
			},

			refreshData: async function() {
				const oldCount = this.appointments.length;
				await this.loadAppointments();
				const newCount = this.appointments.length;
				
				// Si hay nuevos turnos, actualizar la vista
				if (newCount > oldCount) {
					this.renderCalendar();
					this.updateStats();
					// Actualizar debug si est√° visible
					if (!document.getElementById('debug-info').classList.contains('hidden')) {
						this.showDebugInfo();
						this.showDebugInfo(); // Toggle twice to refresh
					}
					console.log('üîî Nuevos turnos detectados!');
				}
			},				renderCalendar: function() {
					const monthNames = [
						'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
						'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
					];

					const currentMonth = this.currentMonth.getMonth();
					const currentYear = this.currentMonth.getFullYear();

					// Actualizar t√≠tulo
					document.getElementById('current-month-title').textContent = 
						`${monthNames[currentMonth]} ${currentYear}`;

					// Limpiar calendario anterior
					const grid = document.getElementById('admin-calendar-grid');
					const existingDays = grid.querySelectorAll('.calendar-day');
					existingDays.forEach(day => day.remove());

					// Calcular d√≠as del mes
					const firstDay = new Date(currentYear, currentMonth, 1);
					const lastDay = new Date(currentYear, currentMonth + 1, 0);
					const daysInMonth = lastDay.getDate();
					const startingDayOfWeek = firstDay.getDay();

					// D√≠as del mes anterior
					const prevMonth = new Date(currentYear, currentMonth - 1, 0);
					for (let i = startingDayOfWeek - 1; i >= 0; i--) {
						const dayNum = prevMonth.getDate() - i;
						const dayDiv = this.createDayElement(dayNum, true);
						grid.appendChild(dayDiv);
					}

					// D√≠as del mes actual
					for (let day = 1; day <= daysInMonth; day++) {
						const date = new Date(currentYear, currentMonth, day);
						const dayDiv = this.createDayElement(day, false, date);
						grid.appendChild(dayDiv);
					}

					// Completar semanas restantes
					const totalCells = grid.children.length - 7; // Restar headers
					const remainingCells = 42 - totalCells;
					for (let day = 1; day <= remainingCells; day++) {
						const dayDiv = this.createDayElement(day, true);
						grid.appendChild(dayDiv);
					}
				},

				createDayElement: function(dayNumber, isOtherMonth = false, date = null) {
					const dayDiv = document.createElement('div');
					dayDiv.className = 'calendar-day';
					
					if (isOtherMonth) {
						dayDiv.classList.add('other-month');
					} else if (date) {
						// Hacer clickeable solo los d√≠as del mes actual
						dayDiv.classList.add('clickable');
						dayDiv.addEventListener('click', () => {
							// Remover selecci√≥n anterior
							document.querySelectorAll('.calendar-day.selected').forEach(day => {
								day.classList.remove('selected');
							});
							// Seleccionar d√≠a actual
							dayDiv.classList.add('selected');
							// Mostrar turnos del d√≠a
							this.showDayAppointments(date);
						});
					}

					// Marcar d√≠a actual
					if (date && this.isToday(date)) {
						dayDiv.classList.add('today');
					}

					const dayNumberDiv = document.createElement('div');
					dayNumberDiv.className = 'day-number';
					dayNumberDiv.textContent = dayNumber;
					dayDiv.appendChild(dayNumberDiv);

					// Agregar turnos si es del mes actual
					if (!isOtherMonth && date) {
						const dayAppointments = this.getAppointmentsForDate(date);
						if (dayAppointments.length > 0) {
							dayAppointments.forEach(appointment => {
								const appointmentDiv = document.createElement('div');
								appointmentDiv.className = 'appointment';
								appointmentDiv.innerHTML = `
									<div class="appointment-time">${appointment.time}</div>
									<div class="appointment-client">${appointment.clientName}</div>
									<div class="appointment-service">${appointment.service}</div>
								`;
								appointmentDiv.addEventListener('click', (e) => {
									e.stopPropagation(); // Evitar que se active el click del d√≠a
									this.showAppointmentDetails(appointment);
								});
								dayDiv.appendChild(appointmentDiv);
							});
						}
					}

					return dayDiv;
				},

				getAppointmentsForDate: function(date) {
					const dateStr = date.toISOString().split('T')[0];
					return this.appointments.filter(apt => apt.date === dateStr);
				},

				isToday: function(date) {
					const today = new Date();
					return date.toDateString() === today.toDateString();
				},

			showAppointmentDetails: function(appointment) {
				const isDemo = appointment.isDemo ? '\nüé® (Turno de demostraci√≥n)' : '';
				const createdAt = appointment.createdAt ? 
					`\nüï∞Ô∏è Reservado: ${new Date(appointment.createdAt).toLocaleString('es-AR')}` : '';
				
				alert(`Turno Detallado:
üìÖ Fecha: ${new Date(appointment.date).toLocaleDateString('es-AR')}
üïê Hora: ${appointment.time}
üë§ Cliente: ${appointment.clientName}
üì± Tel√©fono: ${appointment.clientPhone}
üíÜ‚Äç‚ôÄÔ∏è Servicio: ${appointment.service}${createdAt}${isDemo}`);
			},

			showDebugInfo: function() {
				const debugDiv = document.getElementById('debug-info');
				debugDiv.classList.toggle('hidden');
				
				if (!debugDiv.classList.contains('hidden')) {
					const storedData = localStorage.getItem('jvSpaAppointments');
					const parsedData = storedData ? JSON.parse(storedData) : [];
					
					debugDiv.innerHTML = `
						<h4>üîç Informaci√≥n de Debug:</h4>
						<p><strong>Fecha actual:</strong> ${new Date().toLocaleString('es-AR')}</p>
						<p><strong>Mes del calendario:</strong> ${this.currentMonth.toLocaleDateString('es-AR', { month: 'long', year: 'numeric' })}</p>
						<p><strong>Total turnos en memoria:</strong> ${this.appointments.length}</p>
						<p><strong>Turnos en localStorage:</strong> ${parsedData.length}</p>
						<hr>
						<p><strong>Turnos guardados:</strong></p>
						<pre style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 5px; white-space: pre-wrap; max-height: 200px; overflow-y: auto;">${JSON.stringify(parsedData, null, 2)}</pre>
						<hr>
						<p><strong>B√∫squeda de turno 17 oct 19:30:</strong></p>
						<pre>${this.searchSpecificAppointment('2025-10-17', '19:30')}</pre>
					`;
				}
			},

			searchSpecificAppointment: function(targetDate, targetTime) {
				const found = this.appointments.filter(apt => {
					return apt.date === targetDate && apt.time === targetTime;
				});
				
				if (found.length > 0) {
					return `‚úÖ ENCONTRADO: ${JSON.stringify(found[0], null, 2)}`;
				} else {
					return `‚ùå NO ENCONTRADO. Turnos disponibles:\n${this.appointments.map(apt => `- ${apt.date} ${apt.time} ${apt.clientName}`).join('\n')}`;
				}
			},				updateStats: function() {
					const currentMonth = this.currentMonth.getMonth();
					const currentYear = this.currentMonth.getFullYear();
					const today = new Date();

					// Turnos del mes actual
					const monthAppointments = this.appointments.filter(apt => {
						const aptDate = new Date(apt.date);
						return aptDate.getMonth() === currentMonth && aptDate.getFullYear() === currentYear;
					});

					// Turnos de hoy
					const todayStr = today.toISOString().split('T')[0];
					const todayAppointments = this.appointments.filter(apt => apt.date === todayStr);

					// Turnos de esta semana
					const weekStart = new Date(today);
					weekStart.setDate(today.getDate() - today.getDay());
					const weekEnd = new Date(weekStart);
					weekEnd.setDate(weekStart.getDate() + 6);

					const weekAppointments = this.appointments.filter(apt => {
						const aptDate = new Date(apt.date);
						return aptDate >= weekStart && aptDate <= weekEnd;
					});

					// Actualizar estad√≠sticas
					document.getElementById('total-appointments').textContent = monthAppointments.length;
					document.getElementById('today-appointments').textContent = todayAppointments.length;
					document.getElementById('week-appointments').textContent = weekAppointments.length;
				},

				// Gesti√≥n de modales y formularios
				showAppointmentModal: function(type, appointment = null) {
					const modal = document.getElementById('appointment-modal');
					const title = document.getElementById('modal-title');
					const form = document.getElementById('appointment-form');
					
					this.editingAppointment = appointment;
					
					// Configurar t√≠tulo seg√∫n el tipo
					switch(type) {
						case 'add':
							title.textContent = 'Agregar Nuevo Turno';
							break;
						case 'block':
							title.textContent = 'üö´ Ocupar Horario';
							break;
						case 'fixed':
							title.textContent = 'üìå Crear Turno Fijo';
							break;
						case 'edit':
							title.textContent = 'Editar Turno';
							break;
					}
					
					// Prellenar fecha si hay una seleccionada
					if (this.selectedDate) {
						document.getElementById('appointment-date').value = this.selectedDate.toISOString().split('T')[0];
						this.updateAvailableTimes(this.selectedDate);
					}
					
					// Prellenar servicio seg√∫n tipo
					const serviceSelect = document.getElementById('service-select');
					if (type === 'block') {
						serviceSelect.value = 'OCUPADO';
						document.getElementById('client-name').value = 'HORARIO OCUPADO';
						document.getElementById('client-phone').value = 'N/A';
					} else if (type === 'fixed') {
						serviceSelect.value = 'TURNO FIJO';
						document.getElementById('client-name').value = 'TURNO FIJO';
						document.getElementById('client-phone').value = 'N/A';
					}
					
					// Prellenar datos si es edici√≥n
					if (appointment) {
						document.getElementById('appointment-date').value = appointment.date;
						document.getElementById('appointment-time').value = appointment.time;
						document.getElementById('client-name').value = appointment.clientName;
						document.getElementById('client-phone').value = appointment.clientPhone;
						document.getElementById('service-select').value = appointment.service;
					}
					
					modal.classList.remove('hidden');
				},

				hideAppointmentModal: function() {
					const modal = document.getElementById('appointment-modal');
					const form = document.getElementById('appointment-form');
					
					modal.classList.add('hidden');
					form.reset();
					this.editingAppointment = null;
				},

				saveAppointment: async function() {
					const formData = {
						date: document.getElementById('appointment-date').value,
						time: document.getElementById('appointment-time').value,
						clientName: document.getElementById('client-name').value,
						clientPhone: document.getElementById('client-phone').value,
						service: document.getElementById('service-select').value
					};

					try {
						if (this.editingAppointment) {
							// Editar turno existente
							await this.updateAppointment(this.editingAppointment.id, formData);
						} else {
							// Crear nuevo turno
							await this.addNewAppointment(formData);
						}
						
						this.hideAppointmentModal();
						await this.loadAppointments();
						this.renderCalendar();
						this.updateStats();
						this.showDayAppointments(this.selectedDate);
						
						alert('‚úÖ Turno guardado exitosamente!');
					} catch (error) {
						console.error('Error al guardar turno:', error);
						alert('‚ùå Error al guardar el turno. Intent√° nuevamente.');
					}
				},

				addNewAppointment: async function(appointmentData) {
					if (!window.firebaseDb) {
						// Fallback a localStorage
						const appointments = JSON.parse(localStorage.getItem('jvSpaAppointments') || '[]');
						const newAppointment = {
							id: Date.now().toString(),
							...appointmentData,
							createdAt: new Date().toISOString()
						};
						appointments.push(newAppointment);
						localStorage.setItem('jvSpaAppointments', JSON.stringify(appointments));
						return newAppointment;
					}

					// Usar Firebase
					const { collection, addDoc } = window.firebaseModules;
					const appointmentsRef = collection(window.firebaseDb, 'appointments');
					const docRef = await addDoc(appointmentsRef, {
						...appointmentData,
						createdAt: new Date().toISOString()
					});
					
					return { id: docRef.id, ...appointmentData };
				},

				updateAppointment: async function(id, appointmentData) {
					if (!window.firebaseDb) {
						// Fallback a localStorage
						const appointments = JSON.parse(localStorage.getItem('jvSpaAppointments') || '[]');
						const index = appointments.findIndex(apt => apt.id === id);
						if (index !== -1) {
							appointments[index] = { ...appointments[index], ...appointmentData };
							localStorage.setItem('jvSpaAppointments', JSON.stringify(appointments));
						}
						return;
					}

					// Usar Firebase
					const { doc, updateDoc } = window.firebaseModules;
					const appointmentRef = doc(window.firebaseDb, 'appointments', id);
					await updateDoc(appointmentRef, {
						...appointmentData,
						updatedAt: new Date().toISOString()
					});
				},

				deleteAppointment: async function(id) {
					if (!confirm('¬øEst√°s segura de que quer√©s eliminar este turno?')) {
						return;
					}

					try {
						if (!window.firebaseDb) {
							// Fallback a localStorage
							const appointments = JSON.parse(localStorage.getItem('jvSpaAppointments') || '[]');
							const filtered = appointments.filter(apt => apt.id !== id);
							localStorage.setItem('jvSpaAppointments', JSON.stringify(filtered));
						} else {
							// Usar Firebase
							const { doc, deleteDoc } = window.firebaseModules;
							const appointmentRef = doc(window.firebaseDb, 'appointments', id);
							await deleteDoc(appointmentRef);
						}

						await this.loadAppointments();
						this.renderCalendar();
						this.updateStats();
						this.showDayAppointments(this.selectedDate);
						
						alert('‚úÖ Turno eliminado exitosamente!');
					} catch (error) {
						console.error('Error al eliminar turno:', error);
						alert('‚ùå Error al eliminar el turno. Intent√° nuevamente.');
					}
				},

				showDayAppointments: function(date) {
					if (!date) return;
					
					this.selectedDate = date;
					const dateStr = date.toISOString().split('T')[0];
					const dayAppointments = this.getAppointmentsForDate(date);
					
					document.getElementById('selected-date-title').textContent = 
						`Turnos del ${date.toLocaleDateString('es-AR', { 
							weekday: 'long', 
							day: 'numeric', 
							month: 'long' 
						})}`;
					
					const container = document.getElementById('day-appointments-list');
					
					if (dayAppointments.length === 0) {
						container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.6);">No hay turnos para este d√≠a</p>';
						return;
					}
					
					container.innerHTML = dayAppointments.sort((a, b) => a.time.localeCompare(b.time))
						.map(appointment => `
							<div class="appointment-item">
								<div class="appointment-info">
									<strong>${appointment.time}</strong> - ${appointment.clientName}<br>
									<small>üìû ${appointment.clientPhone} | üíÖ ${appointment.service}</small>
								</div>
								<div class="appointment-actions">
									<button class="btn-small btn-edit" onclick="AdminPanel.editAppointment('${appointment.id}')">‚úèÔ∏è</button>
									<button class="btn-small btn-delete" onclick="AdminPanel.deleteAppointment('${appointment.id}')">üóëÔ∏è</button>
								</div>
							</div>
						`).join('');
				},

				editAppointment: function(id) {
					const appointment = this.appointments.find(apt => apt.id === id);
					if (appointment) {
						this.showAppointmentModal('edit', appointment);
					}
				},

				// Funci√≥n para actualizar horarios disponibles seg√∫n el d√≠a seleccionado
				updateAvailableTimes: function(date) {
					const timeSelect = document.getElementById('appointment-time');
					const dayOfWeek = date.getDay();
					
					// Limpiar opciones actuales
					timeSelect.innerHTML = '<option value="">Seleccionar hora</option>';
					
					let availableTimes = [];
					
				switch(dayOfWeek) {
					case 1: // Lunes - de 14:00 a 19:30
						availableTimes = ['14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00', '18:30', '19:00', '19:30'];
						break;
						
					case 2: // Martes - de 09:00 a 18:00
						availableTimes = ['09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30'];
						break;
						
					case 3: // Mi√©rcoles - de 14:00 a 19:30
						availableTimes = ['14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00', '18:30', '19:00', '19:30'];
						break;
						
					case 4: // Jueves - de 09:00 a 18:00
						availableTimes = ['09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30'];
						break;
						
					case 5: // Viernes - de 09:00 a 16:00
						availableTimes = ['09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30'];
						break;
						
					default: // S√°bado y Domingo - cerrado
						availableTimes = [];
						break;
				}					if (availableTimes.length === 0) {
						timeSelect.innerHTML = '<option value="">No hay horarios disponibles para este d√≠a</option>';
						return;
					}
					
					// Agregar opciones de horarios
					availableTimes.forEach(time => {
						const option = document.createElement('option');
						option.value = time;
						option.textContent = time;
						timeSelect.appendChild(option);
					});
					
					// Actualizar el placeholder con informaci√≥n del d√≠a
					const dayNames = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
					let scheduleInfo = '';
					
					switch(dayOfWeek) {
						case 1: scheduleInfo = ' (Lunes: 14:00-19:30)'; break;
						case 2: scheduleInfo = ' (Martes: 09:00-18:00)'; break;
						case 3: scheduleInfo = ' (Mi√©rcoles: 14:00-19:30)'; break;
						case 4: scheduleInfo = ' (Jueves: 09:00-18:00)'; break;
						case 5: scheduleInfo = ' (Viernes: 09:00-16:00)'; break;
						case 6: scheduleInfo = ' (S√°bado: CERRADO)'; break;
						case 0: scheduleInfo = ' (Domingo: CERRADO)'; break;
					}
					
					timeSelect.firstChild.textContent = `Seleccionar hora${scheduleInfo}`;
				}
			};

			// Inicializar cuando carga la p√°gina
			window.addEventListener('load', async function() {
				await AdminPanel.init();
			});
		</script>

	</body>
</html>